{"version":3,"sources":["../src/cubism_ctrl.js"],"names":[],"mappings":"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","file":"cubism_ctrl.js","sourcesContent":["import {MetricsPanelCtrl} from 'app/plugins/sdk';\nimport _ from 'lodash';\nimport kbn from 'app/core/utils/kbn';\nimport rendering from './rendering';\nimport tinycolor from './tinycolor2/tinycolor';\n\nexport class CubismChartCtrl extends MetricsPanelCtrl {\n\n  constructor($scope, $injector, $rootScope) {\n    super($scope, $injector);\n    this.$rootScope = $rootScope;\n    this.data = [];\n    this.seriesNames = [];\n    this.defaultBands = [\n      {\n        negative: [{rgb: \"rgb(8,81,156)\"}, {rgb: \"rgb(49,130,189)\"}, {rgb: \"rgb(107,174,214)\"}, {rgb: \"rgb(189,215,231)\"}],\n        positive: [{rgb: \"rgb(186,228,179)\"}, {rgb: \"rgb(116,196,118)\"}, {rgb: \"rgb(49,163,84)\"}, {rgb: \"rgb(0,109,44)\"}]\n      },\n      {\n        negative: [{rgb: \"rgb(8,81,156)\"}, {rgb: \"rgb(49,130,189)\"}, {rgb: \"rgb(107,174,214)\"}, {rgb: \"rgb(189,215,231)\"}],\n        positive: [{rgb: \"#bae4b3\"}, {rgb: \"#ffff00\"}, {rgb: \"#ff8000\"}, {rgb: \"#ff0000\"}]\n      },\n      {\n        negative: [{rgb: \"rgb(8,81,156)\"}, {rgb: \"rgb(49,130,189)\"}, {rgb: \"rgb(107,174,214)\"}, {rgb: \"rgb(189,215,231)\"}],\n        positive: [{rgb: \"rgb(255, 198, 198)\"}, {rgb: \"rgb(255, 147, 147)\"}, {rgb: \"rgb(255, 96, 96)\"}, {rgb: \"rgb(255, 45, 45)\"}]\n      }\n    ];\n\n    var panelDefaults = {\n      links: [],\n      datasource: null,\n      interval: null,\n      targets: [{}],\n      cacheTimeout: null,\n      nullPointMode: 'connected',\n      aliasColors: {},\n      format: 'short',\n      valueName: 'current',\n      fontSize: '80%',\n      seriesOverrides: []\n    };\n\n    _.defaults(this.panel, panelDefaults);\n    _.defaults(this.panel.legend, panelDefaults.legend);\n\n    this.events.on('data-received', this.onDataReceived.bind(this));\n    this.events.on('data-error', this.onDataError.bind(this));\n    this.events.on('data-snapshot-load', this.onDataReceived.bind(this));\n    this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n  }\n\n  getSeriesNames(self) {\n    if (self.seriesNames) {\n      return self.seriesNames;\n    } else {\n      return [];\n    }\n  };\n\n  onInitEditMode() {\n    this.addEditorTab('Options', 'public/plugins/grafana-cubism-panel/editor.html', 2);\n    this.unitFormats = kbn.getUnitFormats();\n  }\n\n  setUnitFormat(override, subItem) {\n    override.format = subItem.value;\n    this.render();\n  }\n\n  onDataError() {\n    this.data = [];\n    this.render();\n  }\n\n  changeSeriesColor(series, color) {\n    series.color = color;\n    this.panel.aliasColors[series.alias] = series.color;\n    this.render();\n  }\n\n  onDataReceived(dataList) {\n    this.data = dataList;\n    this.seriesNames = dataList\n      .map(function (series) {\n        return series.alias || series.target;\n      });\n    this.render(this.data);\n  }\n\n  addSeriesOverride() {\n    if (this.panel.seriesOverides == null || this.panel.seriesOverides == undefined) {\n      this.panel.seriesOverides = [];\n    }\n    this.panel.seriesOverides.push(this.defaultSeriesOverride());\n  }\n\n  defaultSeriesOverride() {\n    return {\n      alias: \"\",\n      summaryType: \"sum\",\n      extent: {\n        low: null,\n        high: null\n      },\n      format: \"short\",\n      height: 30,\n      bands: 4,\n      colors: _.cloneDeep(this.defaultBands[0])\n    };\n  }\n\n  bandsChange(override) {\n    if (override.bands > 0 && override.bands <= 10) {\n      this.adjustColorBands(\"-\", override.bands, override.colors.negative);\n      this.adjustColorBands(\"+\", override.bands, override.colors.positive);\n    }\n    console.log(override.colors.positive);\n    this.render();\n  }\n\n  adjustColorBands(which, bands, colorArray) {\n    if (which == \"+\") {\n      colorArray.reverse();\n    }\n    if (colorArray.length > bands) {\n      colorArray.splice(0, colorArray.length - bands)\n    } else if (colorArray.length < bands) {\n      for (var i = 0; i < (bands - colorArray.length); i++) {\n        colorArray.unshift({rgb: tinycolor(colorArray[0].rgb).darken(10).toRgbString()});\n      }\n    }\n    if (which == \"+\") {\n      colorArray.reverse();\n    }\n  }\n\n  setBandsWith(override, defaultColor) {\n    override.bands = defaultColor.positive.length;\n    override.colors = _.cloneDeep(defaultColor);\n  }\n\n  removeSeriesOverride(index) {\n    this.panel.seriesOverides.splice(index, 1);\n    this.render();\n  }\n\n  getMatchingSeriesOverride(series) {\n    var target = series.alias || series.target;\n    var found = _.find(\n      this.panel.seriesOverides,\n      function (override) {\n        if (override.alias && override.alias.length > 0) {\n          if (override.alias[0] == \"/\" && override.alias[override.alias.length - 1] == \"/\") {\n            var pattern = override.alias.substring(1,override.alias.length - 1);\n            var re = new RegExp(pattern);\n            return re.test(target);\n          } else {\n            return override.alias == target;\n          }\n        }\n      }\n    );\n    return found || this.defaultSeriesOverride();\n  }\n\n  //noinspection JSMethodCanBeStatic\n  link(scope, elem, attrs, ctrl) {\n    rendering(scope, elem, attrs, ctrl);\n  }\n}\n\nCubismChartCtrl.templateUrl = 'module.html';\n"]}