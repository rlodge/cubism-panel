{"version":3,"sources":["../src/rendering.js"],"names":[],"mappings":"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","file":"rendering.js","sourcesContent":["import _ from 'lodash';\nimport $ from 'jquery';\nimport 'jquery.flot';\nimport 'jquery.flot.pie';\nimport cubism from './cubism/index';\n\nexport default function link(scope, elem, attrs, ctrl) {\n  var data, panel, context;\n  var cubismContainer = elem.find('.cubism-panel').get(0);\n\n  ctrl.events.on('render', function() {\n    render();\n    ctrl.renderingCompleted();\n  });\n\n  function render() {\n    if (!ctrl.data) {\n      return;\n    }\n\n    cubismContainer.innerHTML = \"\";\n    context = cubism.context()\n      //.serverDelay(scope.cubismServerDelay)\n      .step(1000)\n      .size(\n        Math.floor(d3.select(cubismContainer)\n        .node()\n        .getBoundingClientRect()\n        .width)\n      )\n      .stop();\n\n    data = ctrl.data;\n    panel = ctrl.panel;\n\n    if (setElementHeight()) {\n      d3.select(cubismContainer)\n        .selectAll(\".axis\")\n        .data([\"top\", \"bottom\"])\n        .enter()\n        .append(\"div\")\n        .attr(\"class\", function(d) {\n          return d + \" axis\"\n        })\n        .each(function(d) {\n          d3.select(this)\n            .call(context.axis().ticks(12).orient(d))\n        });\n\n      d3.select(cubismContainer)\n        .append(\"div\")\n        .attr(\"class\", \"rule\")\n        .call(context.rule());\n\n      function random(x) {\n        var value = 0,\n          values = [],\n          i = 0,\n          last;\n        return context.metric(function(start, stop, step, callback) {\n          start = +start, stop = +stop;\n          last = isNaN(last) ? start : last;\n          while (last < stop) {\n            last += step;\n            value = Math.max(-10, Math.min(10, value + .8 * Math.random() -\n              .4 + .2 * Math.cos(i += x * .02)))\n            values.push(value);\n            values = values.slice((start - stop) / stop)\n          }\n          callback(null, values)\n        }, x)\n      }\n\n      //this is where the metrics are created\n      var Data = d3.range(1, 6).map(random);\n      // var primary = Data[4];\n      // var secondary = primary.shift(-30 * 60 * 1000); //why is this metric identical to the primary metric?\n      // Data[5] = secondary;\n\n      console.log(Data);\n\n      d3.select(cubismContainer)\n        .selectAll(\".horizon\")\n        .data(Data)\n        .enter()\n        .insert(\"div\", \".bottom\")\n        .attr(\"class\", \"horizon\")\n        .call(context.horizon()\n          .extent([-10, 10]))\n    }\n  }\n\n  function setElementHeight() {\n    try {\n      var height = ctrl.height || panel.height || ctrl.row.height;\n      if (_.isString(height)) {\n        height = parseInt(height.replace('px', ''), 10);\n      }\n\n      height -= 5; // padding\n      height -= panel.title ? 24 : 9; // subtract panel title bar\n\n      cubismContainer.style.height = height + 'px';\n\n      return true;\n    } catch (e) { // IE throws errors sometimes\n      console.log(e);\n      return false;\n    }\n  }\n\n  function formatter(label, slice) {\n    return \"<div style='font-size:\" + ctrl.panel.fontSize +\n      \";text-align:center;padding:2px;color:\" + slice.color + \";'>\" + label +\n      \"<br/>\" + Math.round(slice.percent) + \"%</div>\";\n  }\n\n}\n"]}